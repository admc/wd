<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>WD.js by admc</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>WD.js</h1>
        <h2>node.js webdriver/selenium 2 client</h2>
        <a href="https://github.com/admc/wd" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a name="wdjs" class="anchor" href="#wdjs"><span class="octicon octicon-link"></span></a>WD.js</h1>

<p><strong>node.js Webdriver/Selenium 2 client</strong></p>

<ul>
<li><a href="http://admc.io/wd/">Site</a></li>
<li><a href="https://groups.google.com/forum/#!forum/wdjs">Mailing List</a></li>
</ul><p><a href="http://travis-ci.org/admc/wd"><img src="https://secure.travis-ci.org/admc/wd.png?branch=master" alt="Build Status"></a>
<a href="https://saucelabs.com/u/wdjs"><img src="https://saucelabs.com/buildstatus/wdjs" alt="Selenium Test Status"></a></p>

<p><a href="https://saucelabs.com/u/wdjs"><img src="https://saucelabs.com/browser-matrix/wdjs.svg" alt="Selenium Test Status"></a></p>

<h2>
<a name="install" class="anchor" href="#install"><span class="octicon octicon-link"></span></a>Install</h2>

<pre><code>npm install wd
</code></pre>

<h2>
<a name="authors" class="anchor" href="#authors"><span class="octicon octicon-link"></span></a>Authors</h2>

<ul>
<li>Adam Christian (<a href="http://github.com/admc">admc</a>)</li>
<li>Ruben Daniels (<a href="https://github.com/javruben">javruben</a>)</li>
<li>Peter Braden (<a href="https://github.com/peterbraden">peterbraden</a>)</li>
<li>Seb Vincent (<a href="https://github.com/sebv">sebv</a>)</li>
<li>Peter 'Pita' Martischka (<a href="https://github.com/Pita">pita</a>)</li>
<li>Jonathan Lipps (<a href="https://github.com/jlipps">jlipps</a>)</li>
<li>Phil Sarin (<a href="https://github.com/pdsarin">pdsarin</a>)</li>
<li>Mathieu Sabourin (<a href="https://github.com/OniOni">OniOni</a>)</li>
<li>Bjorn Tipling (<a href="https://github.com/btipling">btipling</a>)</li>
<li>Santiago Suarez Ordonez (<a href="https://github.com/santiycr">santiycr</a>)</li>
<li>Bernard Kobos (<a href="https://github.com/bernii">bernii</a>)</li>
<li>Jason Carr (<a href="https://github.com/maudineormsby">maudineormsby</a>)</li>
<li>Matti Schneider (<a href="https://github.com/MattiSG">MattiSG</a>)</li>
</ul><h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<ul>
<li>License - Apache 2: <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>
</li>
</ul><h2>
<a name="release-notes" class="anchor" href="#release-notes"><span class="octicon octicon-link"></span></a>Release notes</h2>

<p>Many changes have been introduced in 0.2.x versions, please check 
<a href="https://github.com/admc/wd/blob/master/doc/release-notes.md">here</a> for more details.</p>

<h3>
<a name="023-caveats" class="anchor" href="#023-caveats"><span class="octicon octicon-link"></span></a>0.2.3 caveats</h3>

<ul>
<li>Most wait methods have been deprecated replaced by waitFor/waitForElement + asserters. See doc below, don't hesitate to add more asserters if you feel it is useful for others.</li>
<li>Manual monkey patching is not recommended anymore, there were some side use cases which were not easy to cover.
Use addAsyncMethod/addPromiseMethod/addPromiseChainMethod methods instead. See doc below.</li>
</ul><h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<h3>
<a name="q-promises--chaining" class="anchor" href="#q-promises--chaining"><span class="octicon octicon-link"></span></a>Q promises + chaining</h3>

<div class="highlight highlight-js"><pre><span class="p">...</span>

<span class="nx">browser</span>
  <span class="p">.</span><span class="nx">init</span><span class="p">({</span><span class="nx">browserName</span><span class="o">:</span><span class="s1">'chrome'</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"http://admc.io/wd/test-pages/guinea-pig.html"</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">title</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">should</span><span class="p">.</span><span class="nx">become</span><span class="p">(</span><span class="s1">'WD Tests'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">elementById</span><span class="p">(</span><span class="s1">'i am a link'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">click</span><span class="p">()</span>
  <span class="p">.</span><span class="nb">eval</span><span class="p">(</span><span class="s2">"window.location.href"</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">should</span><span class="p">.</span><span class="nx">eventually</span><span class="p">.</span><span class="nx">include</span><span class="p">(</span><span class="s1">'guinea-pig2'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">back</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">elementByCss</span><span class="p">(</span><span class="s1">'#comments'</span><span class="p">).</span><span class="nx">type</span><span class="p">(</span><span class="s1">'Bonjour!'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">getValue</span><span class="p">().</span><span class="nx">should</span><span class="p">.</span><span class="nx">become</span><span class="p">(</span><span class="s1">'Bonjour!'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">fin</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">quit</span><span class="p">();</span> <span class="p">})</span>
  <span class="p">.</span><span class="nx">done</span><span class="p">();</span>
</pre></div>

<p><a href="https://github.com/admc/wd/blob/master/examples/promise/chrome.js">full code here</a></p>

<h3>
<a name="pure-async" class="anchor" href="#pure-async"><span class="octicon octicon-link"></span></a>Pure async</h3>

<div class="highlight highlight-js"><pre><span class="p">...</span>

<span class="nx">browser</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span><span class="nx">browserName</span><span class="o">:</span><span class="s1">'chrome'</span><span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">browser</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"http://admc.io/wd/test-pages/guinea-pig.html"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">browser</span><span class="p">.</span><span class="nx">title</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">title</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">title</span><span class="p">.</span><span class="nx">should</span><span class="p">.</span><span class="nx">include</span><span class="p">(</span><span class="s1">'WD'</span><span class="p">);</span>
      <span class="nx">browser</span><span class="p">.</span><span class="nx">elementById</span><span class="p">(</span><span class="s1">'i am a link'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">browser</span><span class="p">.</span><span class="nx">clickElement</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="cm">/* jshint evil: true */</span>
          <span class="nx">browser</span><span class="p">.</span><span class="nb">eval</span><span class="p">(</span><span class="s2">"window.location.href"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">href</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">href</span><span class="p">.</span><span class="nx">should</span><span class="p">.</span><span class="nx">include</span><span class="p">(</span><span class="s1">'guinea-pig2'</span><span class="p">);</span>
            <span class="nx">browser</span><span class="p">.</span><span class="nx">quit</span><span class="p">();</span>
          <span class="p">});</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p><a href="https://github.com/admc/wd/blob/master/examples/async/chrome.js">full code here</a></p>

<h3>
<a name="q-promises-without-chaining" class="anchor" href="#q-promises-without-chaining"><span class="octicon octicon-link"></span></a>Q promises without chaining</h3>

<p>See example <a href="https://github.com/admc/wd/blob/master/examples/promise/no-chain.js">here</a>.</p>

<h2>
<a name="generators-api" class="anchor" href="#generators-api"><span class="octicon octicon-link"></span></a>Generators api</h2>

<h3>
<a name="yiewd" class="anchor" href="#yiewd"><span class="octicon octicon-link"></span></a>Yiewd</h3>

<p><a href="https://github.com/jlipps/yiewd">Yiewd</a> is a wrapper around Wd.js that uses
generators in order to avoid nested callbacks, like so:</p>

<div class="highlight highlight-js"><pre><span class="nx">wd</span><span class="p">.</span><span class="nx">remote</span><span class="p">(</span><span class="kd">function</span><span class="o">*</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">yield</span> <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">desiredCaps</span><span class="p">);</span>
  <span class="nx">yield</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"http://mysite.com"</span><span class="p">);</span>
  <span class="nx">el</span> <span class="o">=</span> <span class="nx">yield</span> <span class="k">this</span><span class="p">.</span><span class="nx">elementById</span><span class="p">(</span><span class="s2">"someId"</span><span class="p">);</span>
  <span class="nx">yield</span> <span class="nx">el</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span>
  <span class="nx">el2</span> <span class="o">=</span> <span class="nx">yield</span> <span class="k">this</span><span class="p">.</span><span class="nx">elementById</span><span class="p">(</span><span class="s2">"anotherThing"</span><span class="p">)</span>
  <span class="nx">text</span> <span class="o">=</span> <span class="nx">yield</span> <span class="nx">el2</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
  <span class="nx">text</span><span class="p">.</span><span class="nx">should</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="s2">"What the text should be"</span><span class="p">);</span>
  <span class="nx">yield</span> <span class="k">this</span><span class="p">.</span><span class="nx">quit</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<h2>
<a name="mocha-integration" class="anchor" href="#mocha-integration"><span class="octicon octicon-link"></span></a>Mocha integration</h2>

<div class="highlight highlight-js"><pre><span class="p">...</span>

<span class="nx">describe</span><span class="p">(</span><span class="s2">"using mocha-as-promised and chai-as-promised"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">browser</span><span class="p">;</span>

  <span class="nx">before</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">browser</span> <span class="o">=</span> <span class="nx">wd</span><span class="p">.</span><span class="nx">promiseChainRemote</span><span class="p">();</span>
    <span class="p">...</span>

    <span class="k">return</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span><span class="nx">browserName</span><span class="o">:</span><span class="s1">'chrome'</span><span class="p">});</span>
  <span class="p">});</span>

  <span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"http://admc.io/wd/test-pages/guinea-pig.html"</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">after</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">quit</span><span class="p">();</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="s2">"should retrieve the page title"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">title</span><span class="p">().</span><span class="nx">should</span><span class="p">.</span><span class="nx">become</span><span class="p">(</span><span class="s2">"WD Tests"</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="s2">"submit element should be clicked"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">elementById</span><span class="p">(</span><span class="s2">"submit"</span><span class="p">).</span><span class="nx">click</span><span class="p">().</span><span class="nb">eval</span><span class="p">(</span><span class="s2">"window.location.href"</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">should</span><span class="p">.</span><span class="nx">eventually</span><span class="p">.</span><span class="nx">include</span><span class="p">(</span><span class="s2">"&amp;submit"</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p><a href="https://github.com/admc/wd/blob/master/examples/promise/mocha-specs.js">example here</a></p>

<h2>
<a name="repl" class="anchor" href="#repl"><span class="octicon octicon-link"></span></a>Repl</h2>

<pre><code>./node_modules/.bin/wd shell
</code></pre>

<pre><code>): wd shell
&gt; x = wd.remote() or wd.remote("ondemand.saucelabs.com", 80, "username", "apikey")

&gt; x.init() or x.init({desired capabilities override})
&gt; x.get("http://www.url.com")
&gt; x.eval("window.location.href", function(e, o) { console.log(o) })
&gt; x.quit()
</code></pre>

<h2>
<a name="doc" class="anchor" href="#doc"><span class="octicon octicon-link"></span></a>Doc</h2>

<h3>
<a name="api" class="anchor" href="#api"><span class="octicon octicon-link"></span></a>Api</h3>

<p><a href="https://github.com/admc/wd/blob/master/doc/api.md">jsonwire mapping + api doc</a></p>

<p><a href="https://github.com/admc/wd/blob/master/doc/jsonwire-full-mapping.md">Ã¥full jsonwire mapping</a></p>

<h3>
<a name="jsonwireprotocol" class="anchor" href="#jsonwireprotocol"><span class="octicon octicon-link"></span></a>JsonWireProtocol</h3>

<p>WD is simply implementing the Selenium JsonWireProtocol, for more details see the official docs:</p>

<ul>
<li>
<a href="http://code.google.com/p/selenium/wiki/JsonWireProtocol"></a><a href="http://code.google.com/p/selenium/wiki/JsonWireProtocol">http://code.google.com/p/selenium/wiki/JsonWireProtocol</a>
</li>
</ul><h3>
<a name="browser-initialization" class="anchor" href="#browser-initialization"><span class="octicon octicon-link"></span></a>Browser initialization</h3>

<h4>
<a name="indexed-parameters" class="anchor" href="#indexed-parameters"><span class="octicon octicon-link"></span></a>Indexed parameters</h4>

<div class="highlight highlight-js"><pre><span class="kd">var</span> <span class="nx">browser</span> <span class="o">=</span> <span class="nx">wd</span><span class="p">.</span><span class="nx">remote</span><span class="p">();</span>
<span class="c1">// or</span>
<span class="kd">var</span> <span class="nx">browser</span> <span class="o">=</span> <span class="nx">wd</span><span class="p">.</span><span class="nx">remote</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="c1">// or</span>
<span class="kd">var</span> <span class="nx">browser</span> <span class="o">=</span> <span class="nx">wd</span><span class="p">.</span><span class="nx">remote</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">,</span> <span class="mi">8888</span><span class="p">);</span>
<span class="c1">// or</span>
<span class="kd">var</span> <span class="nx">browser</span> <span class="o">=</span> <span class="nx">wd</span><span class="p">.</span><span class="nx">remote</span><span class="p">(</span><span class="s2">"ondemand.saucelabs.com"</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="s2">"username"</span><span class="p">,</span> <span class="s2">"apikey"</span><span class="p">);</span>
</pre></div>

<h4>
<a name="named-parameters" class="anchor" href="#named-parameters"><span class="octicon octicon-link"></span></a>Named parameters</h4>

<p>The parameters used are similar to those in the <a href="http://nodejs.org/docs/latest/api/url.html">url</a> module.</p>

<div class="highlight highlight-js"><pre><span class="kd">var</span> <span class="nx">browser</span> <span class="o">=</span> <span class="nx">wd</span><span class="p">.</span><span class="nx">remote</span><span class="p">()</span>
<span class="c1">// or</span>
<span class="kd">var</span> <span class="nx">browser</span> <span class="o">=</span> <span class="nx">wd</span><span class="p">.</span><span class="nx">remote</span><span class="p">({</span>
  <span class="nx">hostname</span><span class="o">:</span> <span class="s1">'127.0.0.1'</span><span class="p">,</span>
  <span class="nx">port</span><span class="o">:</span> <span class="mi">4444</span><span class="p">,</span>
  <span class="nx">user</span><span class="o">:</span> <span class="s1">'username'</span><span class="p">,</span>
  <span class="nx">pwd</span><span class="o">:</span> <span class="s1">'password'</span><span class="p">,</span>
<span class="p">});</span>
<span class="c1">// or</span>
<span class="kd">var</span> <span class="nx">browser</span> <span class="o">=</span> <span class="nx">wd</span><span class="p">.</span><span class="nx">remote</span><span class="p">({</span>
  <span class="nx">hostname</span><span class="o">:</span> <span class="s1">'127.0.0.1'</span><span class="p">,</span>
  <span class="nx">port</span><span class="o">:</span> <span class="mi">4444</span><span class="p">,</span>
  <span class="nx">auth</span><span class="o">:</span> <span class="s1">'username:password'</span><span class="p">,</span>
<span class="p">});</span>
</pre></div>

<p>The following parameters may also be used (as in earlier versions):</p>

<div class="highlight highlight-js"><pre><span class="kd">var</span> <span class="nx">browser</span> <span class="o">=</span> <span class="nx">wd</span><span class="p">.</span><span class="nx">remote</span><span class="p">({</span>
  <span class="nx">host</span><span class="o">:</span> <span class="s1">'127.0.0.1'</span><span class="p">,</span>
  <span class="nx">port</span><span class="o">:</span> <span class="mi">4444</span><span class="p">,</span>
  <span class="nx">username</span><span class="o">:</span> <span class="s1">'username'</span><span class="p">,</span>
  <span class="nx">accessKey</span><span class="o">:</span> <span class="s1">'password'</span><span class="p">,</span>
<span class="p">});</span>
</pre></div>

<h4>
<a name="url-string" class="anchor" href="#url-string"><span class="octicon octicon-link"></span></a>Url string</h4>

<div class="highlight highlight-js"><pre><span class="kd">var</span> <span class="nx">browser</span> <span class="o">=</span> <span class="nx">wd</span><span class="p">.</span><span class="nx">remote</span><span class="p">(</span><span class="s1">'http://localhost:4444/wd/hub'</span><span class="p">);</span>
<span class="c1">// or</span>
<span class="kd">var</span> <span class="nx">browser</span> <span class="o">=</span> <span class="nx">wd</span><span class="p">.</span><span class="nx">remote</span><span class="p">(</span><span class="s1">'http://user:apiKey@ondemand.saucelabs.com/wd/hub'</span><span class="p">);</span>
</pre></div>

<h4>
<a name="url-object-created-via-urlparse" class="anchor" href="#url-object-created-via-urlparse"><span class="octicon octicon-link"></span></a>Url object created via url.parse</h4>

<p><a href="http://nodejs.org/docs/v0.10.0/api/url.html#url_url">URL module documentation</a></p>

<div class="highlight highlight-js"><pre><span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'url'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">browser</span> <span class="o">=</span> <span class="nx">wd</span><span class="p">.</span><span class="nx">remote</span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">'http://localhost:4444/wd/hub'</span><span class="p">));</span>
<span class="c1">// or</span>
<span class="kd">var</span> <span class="nx">browser</span> <span class="o">=</span> <span class="nx">wd</span><span class="p">.</span><span class="nx">remote</span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">'http://user:apiKey@ondemand.saucelabs.com:80/wd/hub'</span><span class="p">));</span>
</pre></div>

<h4>
<a name="defaults" class="anchor" href="#defaults"><span class="octicon octicon-link"></span></a>Defaults</h4>

<div class="highlight highlight-js"><pre><span class="p">{</span>
    <span class="nx">protocol</span><span class="o">:</span> <span class="s1">'http:'</span>
    <span class="nx">hostname</span><span class="o">:</span> <span class="s1">'127.0.0.1'</span><span class="p">,</span>
    <span class="nx">port</span><span class="o">:</span> <span class="s1">'4444'</span>
    <span class="nx">path</span><span class="o">:</span> <span class="s1">'/wd/hub'</span>
<span class="p">}</span>
</pre></div>

<h3>
<a name="element-function-chaining-using-promise-chains" class="anchor" href="#element-function-chaining-using-promise-chains"><span class="octicon octicon-link"></span></a>Element function chaining (using promise chains)</h3>

<p>With the promise chain api the method from the <code>browser</code> prototype and the 
<code>element</code> prototype are all available within the <code>browser</code> instance, so it might
be confusing at first. However we tried to keep the logic as simple as possible 
using the principles below: </p>

<ul>
<li>There is no state passed between calls, except for what the method returns.</li>
<li>If the method returns an element the element scope is propagated.</li>
<li>If the method returns nothing (click, type etc...) we make the method return the current element, so the element scope is propagated.</li>
<li>If the method returns something (text, getAttribute...), the element scope is lost.</li>
<li>You may use "&lt;" as the first parameter to get out of the element scope.</li>
<li>You may use "&gt;" as the first parameter to force the call to be done within the current context (mainly used to retrieve subelements).</li>
</ul><p>If you need to do something more complicated, like reusing an element for 2 calls, then 
can either Q promise functionnality (like then, Q.all or Q sequences), or retrieve your
element twice (since the promise chain api is very terse, this is usually acceptable).</p>

<p>Element function chaining example <a href="https://github.com/admc/wd/blob/master/examples/promise/chained-el-func-call.js">here</a></p>

<h3>
<a name="waiting-for-something" class="anchor" href="#waiting-for-something"><span class="octicon octicon-link"></span></a>Waiting for something</h3>

<p>Below are the methods to use to wait for a condition:</p>

<ul>
<li>
<code>browser.waitFor(asserter, timeout, pollFreq, cb) -&gt; cb(err, value)</code>: generic wait method, the return value is provided by the asserter when the condition is satisfied.</li>
<li>
<code>browser.waitForElementBy???(value ,asserter, timeout, pollFreq, cb) -&gt; cb(err, el)</code>: waits for a element then a 
condition, then returns the element.</li>
<li>
<code>browser.waitForConditionInBrowser(conditionExpr, timeout, pollFreq, cb) -&gt; cb(err, boolean)</code>: waits for a js condition within a browser, then returns a boolean.</li>
</ul><p>Asserters should be written using either models below . <code>target</code> may be <code>browser</code> and/or <code>element</code> depending on the context.</p>

<div class="highlight highlight-js"><pre><span class="c1">// async</span>
<span class="kd">var</span> <span class="nx">asyncAsserter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Asserter</span><span class="p">(</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">satisfied</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="c1">// promise</span>
<span class="kd">var</span> <span class="nx">promiseAsserter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Asserter</span><span class="p">(</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="k">return</span> <span class="nx">promise</span><span class="p">;</span> <span class="c1">// promise resolved with the wait_for return value.</span>

    <span class="c1">// Promise asserter should throw errors marked with `err.retriable=true` </span>
    <span class="c1">// when the condition is not satisfied.    </span>
  <span class="p">}</span>
<span class="p">);</span>

</pre></div>

<p>Example <a href="https://github.com/admc/wd/blob/master/examples/promise/wait-for-custom.js">here</a>.</p>

<p>There are ready to use asserters <a href="https://github.com/admc/wd/blob/master/lib/asserters.js">here</a>,
See also the asserter category in the api doc <a href="https://github.com/admc/wd/blob/master/doc/api.md">here</a>.</p>

<h3>
<a name="adding-custom-methods" class="anchor" href="#adding-custom-methods"><span class="octicon octicon-link"></span></a>Adding custom methods</h3>

<ul>
<li>
<code>wd.addAsyncMethod(name, method)</code>: This is for regular async methods with callback as the last argument. This will not only add the method to the async browser prototype, but also wrap the method and add it to the promise and promiseChain prototypes.</li>
<li>
<code>wd.addPromiseMethod(name, method)</code>: This is for promise returning methods NOT USING CHAIN internally. This will not only add the method to the promise browser prototype, but also wrap the method and add it to the promiseChain prototype (but not to the async prototype).</li>
<li>
<code>wd.addPromiseChainMethod(name, method)</code>: This is for promise returning methods USING CHAIN internally. This will only add the method to the promiseChain browser prototype (but neither to async nor to promise browser prototypes).</li>
</ul><p>If you are only using the promise chain api, you should probably stick with <code>wd.addPromiseChainMethod(name, method)</code>.</p>

<p>You may remove a custom method with <code>wd.removeMethod(name)</code>. Not sure why you would want to do that, but that will remove the method from the 3 prototypes.</p>

<p>Please refer to the following examples:</p>

<ul>
<li>
<a href="https://github.com/admc/wd/blob/master/examples/promise/add-method.js">promise chain</a>.</li>
<li>
<a href="https://github.com/admc/wd/blob/master/examples/promise/add-method-async.js">async method used by promise chain</a>.</li>
<li>
<a href="https://github.com/admc/wd/blob/master/examples/promise/add-method-no-chain.js">promise no-chain</a>.</li>
<li>
<a href="https://github.com/admc/wd/blob/master/examples/async/add-method.js">async</a>.</li>
</ul><p>Note: No need to call rewrap anymore.</p>

<h3>
<a name="promise-helpers" class="anchor" href="#promise-helpers"><span class="octicon octicon-link"></span></a>Promise helpers</h3>

<p>This is an alternative to adding custom methods.
See example <a href="https://github.com/admc/wd/blob/master/examples/promise/helper.js">here</a>.</p>

<h3>
<a name="starting-the-promise-chain" class="anchor" href="#starting-the-promise-chain"><span class="octicon octicon-link"></span></a>Starting the promise chain</h3>

<p>The <code>browser</code> and <code>element</code> object are not themselves promises (cause that would lead to chaos), so you 
cannot call Q core methods on them. However you may call one of the method below to initiate the promise 
chain:</p>

<ul>
<li><code>browser.chain()</code></li>
<li><code>browser.noop()</code></li>
<li><code>browser.resolve(promise)</code></li>
<li><code>element.chain()</code></li>
<li><code>element.noop()</code></li>
<li><code>element.resolve(promise)</code></li>
</ul><p>The <code>resolve</code> methods work like <code>Q</code> <code>thenResolve</code>.</p>

<h3>
<a name="working-with-external-promise-libraries" class="anchor" href="#working-with-external-promise-libraries"><span class="octicon octicon-link"></span></a>Working with external promise libraries</h3>

<p><code>wd</code> uses <code>Q</code> internally, but you may use promises from other libraries with the following methods:</p>

<ul>
<li><code>browser.resolve(externalPromise)</code></li>
<li><code>wd.addPromiseChainMethod(name, externalPromise)</code></li>
<li><code>wd.addPromiseMethod(name, externalPromise)</code></li>
</ul><p>The external promise will be automatically wrapped within a Q promise using <code>new Q(externalPromise)</code>.</p>

<p>See example <a href="https://github.com/admc/wd/blob/master/examples/promise/external-promise.js">here</a>.</p>

<h3>
<a name="http-configuration--base-url" class="anchor" href="#http-configuration--base-url"><span class="octicon octicon-link"></span></a>Http configuration / base url</h3>

<p>Http behaviour and base url may be configured via the <code>configureHttp</code> method as 
in the code below:</p>

<div class="highlight highlight-js"><pre><span class="c1">// global config</span>
<span class="nx">wd</span><span class="p">.</span><span class="nx">configureHttp</span><span class="p">({</span>
  <span class="nx">timeout</span><span class="o">:</span> <span class="mi">60000</span><span class="p">,</span>
  <span class="nx">retries</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
  <span class="nx">retryDelay</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span>
  <span class="nx">baseUrl</span> <span class="o">=</span> <span class="s1">'http://example.com/'</span>
<span class="p">});</span>
<span class="c1">// per browser config</span>
<span class="nx">browser</span><span class="p">.</span><span class="nx">configureHttp</span><span class="p">({</span>
  <span class="nx">timeout</span><span class="o">:</span> <span class="mi">60000</span><span class="p">,</span>
  <span class="nx">retries</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
  <span class="nx">retryDelay</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span>
  <span class="nx">baseUrl</span> <span class="o">=</span> <span class="s1">'http://example.com/'</span>
<span class="p">});</span>
</pre></div>

<ul>
<li>timeout: http timeout in ms, default is <code>undefined</code> (uses the server timeout, 
usually 60 seconds). Use <code>'default'</code> or <code>undefined</code> for server default.</li>
<li>retries: Number of reconnection attempts in case the connection is dropped. 
Default is <code>3</code>. Pass <code>0</code> or <code>always</code> to keep trying. Pass <code>-1</code> or <code>never</code> to disable.</li>
<li>retryDelay: the number of ms to wait before reconnecting. Default is <code>15</code>.</li>
<li>baseUrl: the base url use by the <code>get</code> method. The destination url is computed using
<code>url.resolve</code>. Default is empty.</li>
<li>If a field is not specified, the current configuration for this field is
unchanged.</li>
</ul><h3>
<a name="environment-variables-for-saucelabs" class="anchor" href="#environment-variables-for-saucelabs"><span class="octicon octicon-link"></span></a>Environment variables for Saucelabs</h3>

<p>When connecting to Saucelabs, the <code>user</code> and <code>pwd</code> fields can also be set through the <code>SAUCE_USERNAME</code> and <code>SAUCE_ACCESS_KEY</code> environment variables.</p>

<p>The following helper are also available to update sauce jobs: <code>sauceJobUpdate</code> and <code>sauceJobStatus</code>.</p>

<h3>
<a name="safe-methods" class="anchor" href="#safe-methods"><span class="octicon octicon-link"></span></a>Safe Methods</h3>

<p>The <code>safeExecute</code> and <code>safeEval</code> methods are equivalent to <code>execute</code> and <code>eval</code> but the code is
executed within a <code>eval</code> block. They are safe in the sense that eventual
code syntax issues are tackled earlier returning as syntax error and
avoiding browser hanging in some cases.</p>

<p>An example below of expression hanging Chrome:</p>

<div class="highlight highlight-js"><pre><span class="nx">browser</span><span class="p">.</span><span class="nb">eval</span><span class="p">(</span><span class="s2">"wrong!!!"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// hangs</span>
<span class="nx">browser</span><span class="p">.</span><span class="nx">safeEval</span><span class="p">(</span><span class="s2">"wrong!!!"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// returns</span>
<span class="nx">browser</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="s2">"wrong!!!"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//hangs</span>
<span class="nx">browser</span><span class="p">.</span><span class="nx">safeExecute</span><span class="p">(</span><span class="s2">"wrong!!!"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//returns</span>
</pre></div>

<h2>
<a name="run-the-tests" class="anchor" href="#run-the-tests"><span class="octicon octicon-link"></span></a>Run the tests!</h2>

<pre><code># Install the Selenium server, Chromedriver connect
node_modules/.bin/install_selenium
node_modules/.bin/install_chromedriver

#Run the selenium server with chromedriver:
node_modules/.bin/start_selenium_with_chromedriver

cd wd
npm install
make test

# look at the results!
</code></pre>

<h2>
<a name="run-the-tests-on-sauce-labs-cloud" class="anchor" href="#run-the-tests-on-sauce-labs-cloud"><span class="octicon octicon-link"></span></a>Run the tests on Sauce Labs cloud!</h2>

<pre><code># Install Sauce Connect
node_modules/.bin/install_sauce_connect

# Set the following env variales: SAUCE_USERNAME and SAUCE_ACCESS_KEY 

# Start Sauce Sonnect:
node_modules/.bin/start_sauce_connect

cd wd
npm install
make test_e2e_sauce # may be run without sauce connect
make test_midway_sauce_connect

# look at the results on Saucelabs site!
</code></pre>

<h2>
<a name="adding-new-method--contributing" class="anchor" href="#adding-new-method--contributing"><span class="octicon octicon-link"></span></a>Adding new method / Contributing</h2>

<p>If the method you want to use is not yet implemented, that should be
easy to add it to <code>lib/webdriver.js</code>. You can use the <code>doubleclick</code>
method as a template for methods not returning data, and <code>getOrientation</code>
for methods which returns data. No need to modify README as the doc
generation is automated. Other contributions are welcomed.</p>

<h2>
<a name="generating-doc" class="anchor" href="#generating-doc"><span class="octicon octicon-link"></span></a>Generating doc</h2>

<p>The JsonWire mappings in the README and mapping files are generated from code
comments using <a href="https://github.com/visionmedia/dox">dox</a>.</p>

<p>To update the mappings run the following commands:</p>

<pre><code>make mapping &gt; doc/api.md
make full_mapping &gt; doc/jsonwire-full-mapping.md
make unsupported_mapping &gt; doc/jsonwire-unsupported-mapping.md
</code></pre>

<h2>
<a name="publishing" class="anchor" href="#publishing"><span class="octicon octicon-link"></span></a>Publishing</h2>

<pre><code>npm version [patch|minor|major]
git push --tags origin master
npm publish
</code></pre>

<h2>
<a name="test-coverage" class="anchor" href="#test-coverage"><span class="octicon octicon-link"></span></a>Test Coverage</h2>

<p><a href="http://admc.io/wd/istanbul/coverage/lcov-report/index.html">test coverage</a></p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/admc/wd/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/admc/wd/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/admc/wd"></a> is maintained by <a href="https://github.com/admc">admc</a>.</p>

          <p>This page was generated by <a href="pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
